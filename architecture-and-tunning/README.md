# 대용량 아키텍처와 성능 튜닝

![](./images/tunning.jpeg)

아키텍처 설계와 관련된 내용들을 폭넓은 범위에 걸쳐 다루고 있는 책이다. 특히 기술적인 내용 이외에 비즈니스 아키텍쳐를 설계하는 방법에 대해 설명하는 부분도 존재한다. 기대했던 내용은 아니지만 유익한 내용이었던 것 같다. 다만 책이 쓰여진 지 시간이 좀 지났기 때문에, 최신 레퍼런스 아키텍쳐를 설명하는 부분에서는 람다 아키텍쳐를 제외하고는 크게 새롭게 배울 만한 점이 없었던 것 같다. 트렌드와는 상관없이 JVM을 좀 더 깊게 다루고 성능 튜닝을 하는 방법에 대해 소개하는 부분은 굉장히 유익한 내용이라고 생각한다.

## NoSQL

nosql이라는 개념을 접한 지는 꽤 오래되었고, 이전에 다니던 회사에서도 메인 데이터베이스로 nosql을 사용했었지만, 잘 사용하는 방법에 대해 제대로 학습한 적은 없었던 것 같다. 여러 사이드 프로젝트에서 nosql을 쓰려고 노력하면서도 어떤 부분에서 장점이 있는 건지 확실히 실감하지 못했는데, 본 책에서 소개하는 nosql 관련 내용을 읽으면서 어느정도 생각을 정리할 수 있었던 것 같다.

### NoSQL의 등장 배경

기존의 컴퓨팅 시스템은 기업의 업무를 자동화하고 효율화하는 데 그 목적이 있었다. 그래서 기업의 복잡한 데이터를 저장하고 그 데이터 간의 관계를 정의하고 분석하는 데 최적화되어 있는 RDBMS가 메인 데이터베이스로써 지배적으로 사용되어 왔었다. 

하지만 2000년대에 들어서면서 인터넷의 발전과 함께 대형 B2C 서비스들이 등장하기 시작했다. 이러한 서비스들은 데이터 간의 복잡한 관계는 필요 없으며, 이전보다 훨씬 큰 저장 용량과 높은 성능을 필요로 했다. 그에 따라 이러한 니즈에 최적화된 NoSQL이 각광받기 시작했다.

### NoSQL의 특징

- 데이터 간의 관계를 저장하지 않음
- RDBMS에 비해 훨씬 대용량의 데이터 저장 가능
- 분산형 구조
- 고정되지 않은 테이블 스키마

### NoSQL 데이터 모델링

#### 개체 모델 지향에서 쿼리 결과 지향 모델링

RDBMS의 모델링 기법은 저장하고자 하는 도메인 모델을 먼저 분석한 후에 개체 간의 관계를 식별하고 테이블을 추출해내고 테이블을 이용하여 쿼리를 구현하여 결과를 뽑아내는 방식이다. 반면 Nosql의 경우는 RDBMS와는 역순으로 모델링을 진행해야 한다. 어떤 쿼리 결과가 필요한지를 정의한 후에, 이 쿼리 결과를 쉽게 얻어낼 수 있도록 데이터 저장 구조를 설계해야한다.

#### 정규화에서 역정규화로

RDBMS에서는 데이터의 일관성과 도메인 모델과의 일치성을 위해 데이터 모델을 정규화한다. 반대로 nosql은 쿼리의 효율을 위해서 되도록이면 데이터를 중복해서 저장하는 방법인 역정규화가 권장된다.

### Nosql 데이터 모델링 절차

#### 1. 도메인 모델 파악

Nosql이라고 해서 도메인 모델을 파악하고 개체들 간의 관계를 분석하는 작업을 건너뛰어도 되는 것은 아니다. 어떠한 데이터베이스를 쓰든 저장할 데이터에 대한 명확한 이해는 필수다. 책에서는 ERD 까지 그리고 있지만, 개인적으로는 대부분의 경우 그 정도까지는 필요 없이 UML 다이어그램 정도의 수준으로 모델링을 하는 것으로 충분할 것 같다는 생각이 든다. 

#### 2. 쿼리 결과 디자인

클라이언트의 요구사항을 파악하고, 각각의 쿼리에 대해 어떤 결과를 원하는 지를 정리하는 단계이다. Nosql의 역정규화는 이 쿼리 결과를 만족시키기 위해 일어나는 과정이라고 생각해도 좋을 것 같다. 최대한 단순하게 각각의 쿼리 결과를 만족시키기 위해 주로 composite key를 많이 사용하며, 이것을 사용하는 과정에서 역정규화는 자연스럽게 일어난다.

